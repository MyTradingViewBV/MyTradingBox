<div class="trading-view-container">
  <div class="chart-area">
    <!-- Main Chart Container -->
    <div
      class="chart-container"
      (dblclick)="onChartDblClick()"
      (touchstart)="onTouchStart($event)"
      (touchmove)="onTouchMove($event)"
      (touchend)="onTouchEnd($event)"
      (mousedown)="onMouseDown($event)"
      (mousemove)="onMouseMove($event)"
      (mouseup)="onMouseUp($event)"
      (mouseleave)="onMouseUp($event)"
      (wheel)="onWheel($event)"
      [class.interacting]="isInteracting"
      [attr.data-gesture]="gestureType"
    >
      <canvas
        baseChart
        [data]="chartData"
        [options]="chartOptions"
        [type]="'candlestick'"
        #chartCanvas
      >
      </canvas>

      <!-- Enhanced gesture feedback -->
      <div
        class="interaction-overlay"
        *ngIf="isInteracting && gestureType"
        [attr.data-gesture]="gestureType"
      ></div>

      <!-- Axis zone indicators -->
      <div class="axis-zones" *ngIf="!isInteracting">
        <div
          class="x-axis-zone"
          title="Swipe left/right here to adjust candle width"
        ></div>
        <div
          class="y-axis-zone"
          title="Swipe up/down here to adjust candle height"
        ></div>
      </div>
    </div>

    <div class="price-info-bar">
      <div class="top-controls">
        <div class="select-group">
          <label class="symbol-select">
            <span class="visually-hidden">Symbol</span>
            <select
              [(ngModel)]="selectedSymbol"
              (change)="onSymbolChange(selectedSymbol)"
            >
              <option
                *ngFor="let symbol of availableSymbols"
                [ngValue]="symbol"
              >
                {{ symbol.SymbolName }}
              </option>
            </select>
          </label>

            <label class="timeframe-select-short">
              <span class="visually-hidden">Timeframe</span>
              <select
                [(ngModel)]="selectedTimeframe"
                (change)="onTimeframeChange(selectedTimeframe)"
              >
                <option *ngFor="let tf of visibleTimeframes" [value]="tf.value">
                  {{ tf.label }}
                </option>
              </select>
            </label>
        </div>

        <div class="top-settings">
          <button
            type="button"
            class="settings-btn-top"
            (click)="toggleSettings()"
            aria-label="Settings"
            title="Instellingen"
          >⚙️</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Settings panel: appears below the settings icon, right-aligned -->
  <div class="settings-panel-overlay" *ngIf="showSettings">
    <label
      style="display: flex; align-items: center; gap: 8px; margin-bottom: 8px"
    >
      <input
        type="checkbox"
        [(ngModel)]="showBoxes"
        (change)="onBoxesToggle()"
      />
      <span style="color: #ddd">Show Boxes</span>
    </label>

    <label
      style="display: flex; align-items: center; gap: 8px; margin-bottom: 8px"
    >
      <input
        type="checkbox"
        [(ngModel)]="showKeyZones"
        (change)="onToggleKeyZones()"
      />
      <span style="color: #ddd">Key Zones</span>
    </label>

    <label
      style="display: flex; align-items: center; gap: 8px; margin-bottom: 8px"
    >
      <input
        type="checkbox"
        [(ngModel)]="showOrders"
        (change)="onOrdersToggle()"
      />
      <span style="color: #ddd">Trade Orders</span>
    </label>

    <label
      style="display: flex; align-items: center; gap: 8px; margin-bottom: 8px"
    >
      <input
        type="checkbox"
        [(ngModel)]="showIndicators"
        (change)="onToggleIndicators()"
      />
      <span style="color: #ddd">Indicators</span>
    </label>

    <div style="display: flex; flex-direction: column; gap: 6px">
      <label style="display: flex; align-items: center; gap: 8px">
        <input
          type="radio"
          name="boxMode"
          [value]="'boxes'"
          [(ngModel)]="boxMode"
          (click)="onBoxModeChange('boxes')"
        />
        <span style="color: #ddd">Trade Boxes</span>
      </label>

      <label style="display: flex; align-items: center; gap: 8px">
        <input
          type="radio"
          name="boxMode"
          [value]="'all'"
          [(ngModel)]="boxMode"
          (click)="onBoxModeChange('all')"
        />
        <span style="color: #ddd">Alle Boxes</span>
      </label>
    </div>
  </div>
</div>
