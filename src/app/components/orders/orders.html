<div class="orders-container">
  <!-- Top bar (dark mode styled similar to chart header) -->
  <div class="orders-top-bar">
    <div class="orders-controls">
      <div class="orders-actions-group">
        <button mat-stroked-button class="toolbar-btn" (click)="back()" [disabled]="loading" aria-label="Back">
          <mat-icon fontIcon="arrow_back"></mat-icon>
          <span class="btn-text">Back</span>
        </button>
        <button mat-stroked-button class="toolbar-btn" (click)="refresh()" [disabled]="loading" aria-label="Refresh">
          <mat-icon fontIcon="refresh"></mat-icon>
          <span class="btn-text">Refresh</span>
        </button>
      </div>

      <!-- Status Filter -->
      <mat-form-field appearance="outline" class="status-filter dense-select">
        <mat-select
          [(value)]="selectedStatus"
          (selectionChange)="filterOrders()"
          [disabled]="loading"
          placeholder="Status"
        >
          <mat-option value="">All</mat-option>
          <mat-option value="ACTIVE">ACTIVE</mat-option>
          <mat-option value="NEW">NEW</mat-option>
          <mat-option value="DONE">DONE</mat-option>
        </mat-select>
      </mat-form-field>
    </div>
    <div class="orders-top-spacer"></div>
    <div class="orders-secondary-actions">
      <!-- Future extra actions placeholder (settings, export, etc.) -->
    </div>
  </div>

  <!-- Summary (keep as card for clarity) -->
  <mat-card class="summary-card" *ngIf="!loading">
    <mat-card-content>
      balance: {{ fullResult.AccountBalance }}
      <div class="summary-row">
        <span>AccountBalanceWithOpenOrders:</span>
        <strong
          [ngClass]="{
            positive: fullResult.AccountBalanceWithOpenOrders > 0,
            negative: fullResult.AccountBalanceWithOpenOrders < 0,
          }"
        >
          $ {{ fullResult.AccountBalanceWithOpenOrders | number: "1.2-2" }}
        </strong>
      </div>

      <div class="summary-row">
        <span>ClosedRealizedAmount:</span>
        <strong
          [ngClass]="{
            positive: fullResult.ClosedRealizedAmount > 0,
            negative: fullResult.ClosedRealizedAmount < 0,
          }"
        >
          {{ fullResult.ClosedRealizedAmount | number: "1.2-2" }}%
        </strong>
      </div>

      <div class="summary-row">
        <span>MarketValueOpenOrders</span>
        <strong
          [ngClass]="{
            positive: fullResult.MarketValueOpenOrders > 0,
            negative: fullResult.MarketValueOpenOrders < 0,
          }"
        >
          $ {{ fullResult.MarketValueOpenOrders | number: "1.2-2" }}
        </strong>
      </div>
      <div class="summary-row">
        <span>OpenUnrealizedAmount</span>
        <strong
          [ngClass]="{
            positive: fullResult.OpenUnrealizedAmount > 0,
            negative: fullResult.OpenUnrealizedAmount < 0,
          }"
        >
          $ {{ fullResult.OpenUnrealizedAmount | number: "1.2-2" }}
        </strong>
      </div>
      <div class="summary-row">
        <span>TotalPercentageAmount</span>
        <strong
          [ngClass]="{
            positive: fullResult.TotalPercentageAmount > 0,
            negative: fullResult.TotalPercentageAmount < 0,
          }"
        >
          {{ fullResult.TotalPercentageAmount | number: "1.2-2" }}%
        </strong>
      </div>
    </mat-card-content>
  </mat-card>

  <!-- <mat-card>
    <mat-card-content>
      <button
        mat-stroked-button
        *ngFor="let item of watchlist"
        [ngClass]="{
          grey: item.Direction === 'NONE',
          green: !item.Direction,
          red: item.Direction === 'BEAR',
        }"
        (click)="selectedTimeframe = item.Timeframe"
      >
        {{ item.Timeframe }}
      </button>
    </mat-card-content>
  </mat-card> -->

  <!-- Show only selected card(s) -->
  <mat-card>
    <mat-card-content>
      <div class="watchlist-buttons">
        <button
          mat-stroked-button
          *ngFor="let item of watchlist; let i = index"
          [ngClass]="{
            grey: item.Direction === 'NONE',
            green: !item.Direction || item.Direction === 'BULL',
            red: item.Direction === 'BEAR',
          }"
        >
          {{ item.Timeframe }} - {{ item.Direction }}
        </button>
      </div>
    </mat-card-content>
  </mat-card>
  <!-- Loading spinner -->
  <div class="spinner-container" *ngIf="loading">
    <mat-spinner diameter="100"></mat-spinner>
  </div>

  <!-- Orders as expansion panels -->
  <mat-accordion *ngIf="!loading" class="orders-accordion">
    <mat-expansion-panel *ngFor="let order of filteredOrders">
      <mat-expansion-panel-header>
        <mat-panel-title>
          <!-- PnL percent with color -->
          <span
            [ngClass]="{
              positive: order.PnlAmount > 0,
              negative: order.PnlAmount < 0,
            }"
          >
            {{ order.PnlPercent | number: "1.2-2" }}%
          </span>

          {{ order.Symbol }} •

          <!-- Direction with its own color logic -->
          <span
            [ngClass]="{
              positive: order.Direction === 'LONG',
              negative: order.Direction === 'SHORT',
            }"
          >
            {{ order.Direction }}
          </span>

          • {{ order.Status }}
        </mat-panel-title>
      </mat-expansion-panel-header>

      <div class="order-row">
        <span>Entry:</span>
        <span>$ {{ order.EntryPrice | number: "1.2-4" }}</span>
      </div>

      <div class="order-row">
        <span>Current Price:</span>
        <span>$ {{ order.CurrentPrice | number: "1.2-4" }}</span>
      </div>

      <div class="order-row">
        <span>Stop Loss:</span>
        <span>$ {{ order.StopLoss | number: "1.2-4" }}</span>
      </div>

      <div class="order-row">
        <span>Target 1:</span>
        <span>$ {{ order.TargetPrice | number: "1.2-4" }}</span>
      </div>

      <div class="order-row">
        <span>Target 2:</span>
        <span>$ {{ order.Target2Price | number: "1.2-4" }}</span>
      </div>

      <div class="order-row">
        <span>Timeframe:</span>
        <span
          >{{ order.ExecutionTimeframe }} /
          {{ order.ConfirmationTimeframe }}</span
        >
      </div>

      <div class="order-row created-at">
        <span>Created:</span>
        <span>{{ order.CreatedAt | date: "HH:mm dd/MM/yyyy" }}</span>
      </div>

      <div class="order-row" *ngIf="order.ExitPrice">
        <span>Exit Price:</span>
        <span>$ {{ order.ExitPrice | number: "1.2-4" }}</span>
      </div>

      <div class="order-row" *ngIf="order.ExitType">
        <span>Exit Type:</span>
        <span>{{ order.ExitType }}</span>
      </div>

      <div class="order-row" *ngIf="order.FailureReason">
        <span>Failure Reason:</span>
        <span>{{ order.FailureReason }}</span>
      </div>

      <div class="order-row">
        <span>Entry option:</span>
        <span>{{ order.EntryOption }}</span>
      </div>

      <div class="order-row">
        <span>ConfidenceScore:</span>
        <span>{{ order.ConfidenceScore }}</span>
      </div>

      <div class="order-row">
        <span>ConfidenceReason:</span>
        <span>{{ order.ConfidenceReason }}</span>
      </div>

      <div class="order-row">
        <span>Quantity:</span>
        <span>{{ order.Quantity }}</span>
      </div>
      <div class="order-row">
        <span>Realized / Unrealized:</span>
        <span>
          <span [ngClass]="{ positive: order.RealizedAmount > 0, negative: order.RealizedAmount < 0 }">
            {{ order.RealizedAmount | number: '1.2-2' }}
          </span>
          /
          <span [ngClass]="{ positive: order.UnrealizedAmount > 0, negative: order.UnrealizedAmount < 0 }">
            {{ order.UnrealizedAmount | number: '1.2-2' }}
          </span>
        </span>
      </div>
      <div class="order-row" *ngIf="order.Target1ExitedQuantity || order.Target1ExitPrice">
        <span>Target1 Exited:</span>
        <span>{{ order.Target1ExitedQuantity }} &#64; $ {{ order.Target1ExitPrice || '-' }}</span>
      </div>
      <div class="order-row" *ngIf="order.Target2ExitedQuantity || order.Target2ExitPrice">
        <span>Target2 Exited:</span>
        <span>{{ order.Target2ExitedQuantity }} &#64; $ {{ order.Target2ExitPrice || '-' }}</span>
      </div>
      <div class="order-row" *ngIf="order.SourceSignalType">
        <span>Signal Type:</span>
        <span>{{ order.SourceSignalType }}</span>
      </div>

      <div class="order-row actions">
        <button
          mat-stroked-button
          color="primary"
          (click)="goToChart(order.Symbol)"
        >
          Open Chart
        </button>
      </div>
    </mat-expansion-panel>
  </mat-accordion>
</div>
