<div class="chart-wrapper">
  <!-- ‚öôÔ∏è Settings toggle button -->
  <button
    mat-icon-button
    class="settings-btn"
    (click)="toggleSettings()"
    aria-label="Settings"
  >
    <mat-icon>settings</mat-icon>
  </button>

  <!-- ‚öôÔ∏è Settings panel -->
  <div class="settings-panel" *ngIf="showSettings">
    <mat-checkbox [(ngModel)]="showBoxes" (change)="onBoxesToggle()">
      Show Boxes
    </mat-checkbox>

    <mat-form-field appearance="outline" class="symbol-select">
      <mat-label>Symbol</mat-label>
      <mat-select
        [(value)]="selectedSymbol"
        (selectionChange)="onSymbolChange()"
      ><!--$event.value-->
        <mat-option *ngFor="let s of symbols" [value]="s">
          {{ s.SymbolName }}
        </mat-option>
      </mat-select>
    </mat-form-field>
  </div>

  <div class="trading-view-container">
    <!-- Chart Area (main focus, taller) -->
    <div class="chart-area">
      <!-- Price info bar at top -->
      <div class="price-info-bar">
        <div class="current-price">
          <span class="price-value">{{ currentPrice | number: "1.2-2" }}</span>
          <span
            class="price-change"
            [class.positive]="priceChange >= 0"
            [class.negative]="priceChange < 0"
          >
            {{ priceChangeFormatted }}
          </span>
        </div>
        <div class="currency-selector">
          <select class="currency-dropdown">
            <option value="USD">USD</option>
            <option value="EUR">EUR</option>
            <option value="GBP">GBP</option>
          </select>
        </div>
      </div>

      <!-- Main Chart Container -->
      <div
        class="chart-container"
        (dblclick)="onChartDblClick()"
        (touchstart)="onTouchStart($event)"
        (touchmove)="onTouchMove($event)"
        (touchend)="onTouchEnd($event)"
        (mousedown)="onMouseDown($event)"
        (mousemove)="onMouseMove($event)"
        (mouseup)="onMouseUp($event)"
        (mouseleave)="onMouseUp($event)"
        (wheel)="onWheel($event)"
        [class.interacting]="isInteracting"
        [attr.data-gesture]="gestureType"
      >
        <canvas
          baseChart
          [data]="chartData"
          [options]="chartOptions"
          [type]="'candlestick'"
          #chartCanvas
        >
        </canvas>

        <!-- Enhanced gesture feedback -->
        <div
          class="interaction-overlay"
          *ngIf="isInteracting && gestureType"
          [attr.data-gesture]="gestureType"
        >
          <div class="gesture-indicator">
            <ng-container [ngSwitch]="gestureType">
              <span *ngSwitchCase="'zoom-x'" class="zoom-hint"
                >‚Üî Candle Width (X-Axis)</span
              >
              <span *ngSwitchCase="'zoom-y'" class="zoom-hint"
                >‚Üï Candle Height (Y-Axis)</span
              >
              <span *ngSwitchCase="'pinch'" class="zoom-hint"
                >üîç Pinch Zoom</span
              >
              <span *ngSwitchCase="'pan'" class="zoom-hint">‚úã Pan Chart</span>
            </ng-container>
          </div>
        </div>

        <!-- Restored axis zone indicators -->
        <div class="axis-zones" *ngIf="!isInteracting">
          <div
            class="x-axis-zone"
            title="Swipe left/right here to adjust candle width"
          ></div>
          <div
            class="y-axis-zone"
            title="Swipe up/down here to adjust candle height"
          ></div>
        </div>
      </div>
    </div>

    <!-- Mobile Quick Actions Toolbar (additional) -->
    <!--<div class="mobile-quick-toolbar" *ngIf="true">
    <button class="quick-btn" (click)="resetZoom()" title="Reset Zoom">
      <svg width="16" height="16" viewBox="0 0 16 16">
        <path fill="currentColor" d="M8 2L6.5 3.5L10 7H2V9H10L6.5 12.5L8 14L14 8L8 2Z"/>
      </svg>
      <span>Reset</span>
    </button>
    
    <button class="quick-btn" (click)="fitToData()" title="Fit All Data">
      <svg width="16" height="16" viewBox="0 0 16 16">
        <path fill="currentColor" d="M2 2V6H4V4H6V2H2ZM10 2V4H12V6H14V2H10ZM2 10V14H6V12H4V10H2ZM14 10H12V12H10V14H14V10Z"/>
      </svg>
      <span>Fit</span>
    </button>
    
    <button class="quick-btn" [class.active]="selectedTimeframe === '1m'" (click)="onTimeframeChange('1m')">
      <span>1m</span>
    </button>
    
    <button class="quick-btn" [class.active]="selectedTimeframe === '1h'" (click)="onTimeframeChange('1h')">
      <span>1h</span>
    </button>
    
    <button class="quick-btn" [class.active]="selectedTimeframe === '1d'" (click)="onTimeframeChange('1d')">
      <span>1D</span>
    </button>
  </div>-->

    <!-- TradingView-style toolbar below chart -->
    <div class="chart-toolbar">
      <!-- Symbol and timeframe section -->
      <div class="left-section">
        <div class="symbol-selector">
          <select
            class="symbol-dropdown"
            [(ngModel)]="selectedSymbol"
            (change)="onSymbolChange()"
          >
            <option
              *ngFor="let symbol of availableSymbols"
              [value]="symbol.SymbolName"
            >
              {{ symbol.SymbolName }}
            </option>
          </select>
        </div>

        <div class="timeframe-selector">
          <button
            *ngFor="let tf of timeframes"
            class="timeframe-btn"
            [class.active]="tf.value === selectedTimeframe"
            (click)="onTimeframeChange(tf.value)"
          >
            {{ tf.label }}
          </button>
        </div>
      </div>
    </div>
  </div>
</div>
