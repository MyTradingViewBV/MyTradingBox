<div class="trading-view-container">
  <!-- Chart Area (main focus, taller) -->
  <div class="chart-area">
    <!-- Price info bar at top -->
    <div class="price-info-bar">

      <!-- New: top controls (symbol + timeframe) above price -->
      <div class="top-controls">
        <div class="symbol-selector">
          <select
            class="symbol-dropdown"
            [(ngModel)]="selectedSymbol"
            (ngModelChange)="onSymbolChange($event)"
          >
            <option *ngFor="let symbol of availableSymbols" [ngValue]="symbol">
              {{ symbol.SymbolName }}
            </option>
          </select>
        </div>

        <div class="timeframe-selector">
          <button
            *ngFor="let tf of timeframes"
            class="timeframe-btn"
            [class.active]="tf.value === selectedTimeframe"
            (click)="onTimeframeChange(tf.value)"
          >
            {{ tf.label }}
          </button>
        </div>

        <!-- Settings button on same line as symbol/timeframe -->
        <div class="top-settings">
          <button
            mat-icon-button
            class="settings-btn-top"
            (click)="toggleSettings()"
            aria-label="Settings"
            title="Instellingen"
          >
            <mat-icon>settings</mat-icon>
          </button>
        </div>
      </div>
 
    </div>

    <!-- Main Chart Container -->
    <div
      class="chart-container"
      (dblclick)="onChartDblClick()"
      (touchstart)="onTouchStart($event)"
      (touchmove)="onTouchMove($event)"
      (touchend)="onTouchEnd($event)"
      (mousedown)="onMouseDown($event)"
      (mousemove)="onMouseMove($event)"
      (mouseup)="onMouseUp($event)"
      (mouseleave)="onMouseUp($event)"
      (wheel)="onWheel($event)"
      [class.interacting]="isInteracting"
      [attr.data-gesture]="gestureType"
    >
      <canvas
        baseChart
        [data]="chartData"
        [options]="chartOptions"
        [type]="'candlestick'"
        #chartCanvas
      >
      </canvas>

      <!-- Enhanced gesture feedback -->
      <div
        class="interaction-overlay"
        *ngIf="isInteracting && gestureType"
        [attr.data-gesture]="gestureType"
      >
      </div>

      <!-- Restored axis zone indicators -->
      <div class="axis-zones" *ngIf="!isInteracting">
        <div
          class="x-axis-zone"
          title="Swipe left/right here to adjust candle width"
        ></div>
        <div
          class="y-axis-zone"
          title="Swipe up/down here to adjust candle height"
        ></div>
      </div>
    </div>
  </div>

  <!-- TradingView-style toolbar below chart -->
  <div class="chart-toolbar">
    <!-- Keep toolbar but remove duplicate symbol/timeframe to avoid duplication -->
    <div class="left-section">
      <!-- intentionally left empty: symbol/timeframe moved to header -->
    </div>
  </div>

  <!-- Settings panel moved outside the header so it appears below the topbar when opened -->
  <div class="settings-panel-overlay" *ngIf="showSettings">
    <label style="display:flex;align-items:center;gap:8px;margin-bottom:8px;">
      <input
        type="checkbox"
        [(ngModel)]="showBoxes"
        (change)="onBoxesToggle()"
      />
      <span style="color:#ddd">Show Boxes</span>
    </label>

    <label style="display:flex;align-items:center;gap:8px;margin-bottom:8px;">
      <input
        type="checkbox"
        [(ngModel)]="showKeyZones"
        (change)="onToggleKeyZones()"
      />
      <span style="color:#ddd">Key Zones</span>
    </label>

    <!-- Trade Orders checkbox (re-added) -->
    <label style="display:flex;align-items:center;gap:8px;margin-bottom:8px;">
      <input
        type="checkbox"
        [(ngModel)]="showOrders"
        (change)="onOrdersToggle()"
      />
      <span style="color:#ddd">Trade Orders</span>
    </label>

    <!-- New: Indicator toggle -->
    <label style="display:flex;align-items:center;gap:8px;margin-bottom:8px;">
      <input
        type="checkbox"
        [(ngModel)]="showIndicators"
        (change)="onToggleIndicators()"
      />
      <span style="color:#ddd">Indicators</span>
    </label>

    <div style="display:flex;flex-direction:column;gap:6px;">
      <label style="display:flex;align-items:center;gap:8px;">
        <input type="radio" name="boxMode" [value]="'boxes'" [(ngModel)]="boxMode" (click)="onBoxModeChange('boxes')" />
        <span style="color:#ddd">Trade Boxes</span>
      </label>

      <label style="display:flex;align-items:center;gap:8px;">
        <input type="radio" name="boxMode" [value]="'all'" [(ngModel)]="boxMode" (click)="onBoxModeChange('all')" />
        <span style="color:#ddd">Alle Boxes</span>
      </label>
    </div>
  </div>
</div>
