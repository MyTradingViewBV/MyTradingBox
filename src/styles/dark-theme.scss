/* Dark theme overrides activated when body has class 'dark-theme' */
/* Declare theme variables on body.dark-theme and overlay containers so they are available for overlay panels too */
body.dark-theme,
.cdk-overlay-container.dark-theme,
.cdk-overlay-container {
  --app-bg: #0b0f12;
  --app-fg: #e6eef0;
  --card-bg: #0f1619;
  --muted: #9aa6ab;
}

body.dark-theme {
  background-color: var(--app-bg);
  color: var(--app-fg);

  a { color: #66d9ff; }

  header.app-header {
    background-color: #071018 !important;
    color: var(--app-fg) !important;
  }

  .mat-mdc-card {
    background: var(--card-bg) !important;
    color: var(--app-fg) !important;
  }

  /* Chart canvas background */
  canvas { background: transparent !important; }
}

/* Dark theme overrides for Angular Material select / option panels */
/* Cover both MDC and legacy class names and overlay containers */
.cdk-overlay-container.dark-theme .cdk-overlay-pane .mat-mdc-select-panel,
.cdk-overlay-container.dark-theme .cdk-overlay-pane .mat-select-panel,
.cdk-overlay-container .cdk-overlay-pane .mat-mdc-select-panel,
.cdk-overlay-container .cdk-overlay-pane .mat-select-panel,
.mat-mdc-select-panel,
.mat-select-panel {
  background: var(--card-bg) !important;
  color: var(--app-fg) !important;
  box-shadow: 0 4px 20px rgba(0,0,0,0.6) !important;
}

/* Ensure list background inside panel is dark */
.mat-mdc-select-panel .mdc-list,
.mat-select-panel .mdc-list,
.mat-mdc-select-panel .mat-mdc-list,
.mat-select-panel .mat-mdc-list {
  background: transparent !important;
}

/* Option items: force light text and transparent item background (panel provides bg) */
.mat-mdc-option,
.mat-option,
.mat-mdc-select-panel .mat-mdc-list-item,
.mat-mdc-select-panel .mat-option,
.mat-select-panel .mat-option,
.mat-select-panel .mat-mdc-list-item {
  background: transparent !important;
  color: var(--app-fg) !important;
}

/* Some implementations put text in nested spans or mdc classes - cover them */
.mat-mdc-option .mdc-list-item__primary-text,
.mat-mdc-option .mat-mdc-list-item__text,
.mat-option .mat-select-value-text,
.mat-option .mat-option-text,
.mat-option span,
.mdc-list-item__primary-text,
.mdc-list-item__secondary-text,
.mat-mdc-list-item .mdc-list-item__primary-text {
  color: var(--app-fg) !important;
}

/* Placeholder and disabled color */
.mat-mdc-select .mat-mdc-select-placeholder,
.mat-select .mat-select-placeholder,
.mat-mdc-select .mat-mdc-select-placeholder .mat-mdc-select-value-text {
  color: var(--muted) !important;
}

/* Hover and selected states */
.mat-mdc-option:hover,
.mat-option:hover,
.mdc-list-item--selected,
.mdc-list-item--activated {
  background: rgba(255,255,255,0.06) !important;
}

.mat-mdc-option.mat-mdc-selected,
.mat-option.mat-selected,
.mdc-list-item--selected {
  background: rgba(255,255,255,0.12) !important;
  color: var(--app-fg) !important;
}

/* Ensure selected value text (inside the select trigger) is light */
.mat-mdc-select .mat-mdc-select-value,
.mat-select .mat-select-value,
.mdc-select__selected-text,
.mat-mdc-select-value-text,
.mat-select-value-text {
  color: var(--app-fg) !important;
}

/* Remove unexpected black backgrounds/rules by increasing specificity */
.cdk-overlay-container.dark-theme .mat-select-panel .mat-option,
.cdk-overlay-container.dark-theme .mat-mdc-select-panel .mat-mdc-option,
body.dark-theme .mat-select-panel .mat-option,
body.dark-theme .mat-mdc-select-panel .mat-mdc-option {
  background: transparent !important;
  color: var(--app-fg) !important;
}

/* Ensure the select trigger / form-field has a dark background so closed combobox is readable */
/* Cover MDC and legacy form-field structures */
body.dark-theme .mat-mdc-form-field .mat-mdc-form-field-flex,
body.dark-theme .mat-mdc-form-field .mat-mdc-form-field-outline,
body.dark-theme .mat-form-field .mat-form-field-wrapper,
body.dark-theme .mat-form-field .mat-form-field-infix,
body.dark-theme .mat-form-field-appearance-outline .mat-form-field-outline,
body.dark-theme .mat-select-trigger,
body.dark-theme .mat-mdc-select-trigger,
body.dark-theme .mat-select-value,
body.dark-theme .mat-mdc-select-value {
  background: var(--card-bg) !important;
  color: var(--app-fg) !important;
}

/* Also ensure the underlying input/text inside trigger is light */
body.dark-theme .mat-select-trigger .mat-select-value-text,
body.dark-theme .mat-mdc-select-trigger .mat-mdc-select-value-text,
body.dark-theme .mat-form-field .mat-select-value-text {
  color: var(--app-fg) !important;
}

/* Extra high-specificity fallbacks to ensure overlays and all their descendants use dark background + light text */
body.dark-theme .cdk-overlay-container,
.cdk-overlay-container.dark-theme {
  background: var(--card-bg) !important;
  color: var(--app-fg) !important;
}

/* Ensure overlay panes (where mat-select panels live) inherit dark background */
.cdk-overlay-pane .mat-select-panel,
.cdk-overlay-pane .mat-mdc-select-panel,
.cdk-overlay-pane .mat-select-panel *,
.cdk-overlay-pane .mat-mdc-select-panel * {
  background: var(--card-bg) !important;
  color: var(--app-fg) !important;
}

/* Force all text inside panels to be light for readability */
.cdk-overlay-pane .mat-select-panel *,
.cdk-overlay-pane .mat-mdc-select-panel * {
  color: var(--app-fg) !important;
}

/* Ensure the closed select trigger has a dark background and light text */
body.dark-theme .mat-select-trigger,
body.dark-theme .mat-mdc-select-trigger,
body.dark-theme .mat-select-trigger *,
body.dark-theme .mat-mdc-select-trigger * {
  background: var(--card-bg) !important;
  color: var(--app-fg) !important;
}

/* Native selects fallback */
body.dark-theme select,
body.dark-theme option {
  background: var(--card-bg) !important;
  color: var(--app-fg) !important;
}

/* Utility panel class for forcing dark panel styling when added via panelClass on mat-select */
.dark-panel,
.cdk-overlay-container .dark-panel,
.cdk-overlay-pane .dark-panel {
  background: var(--card-bg) !important;
  color: var(--app-fg) !important;
}

/* Ensure all descendants (texts/icons) inside a dark-panel are light */
.dark-panel *,
.cdk-overlay-container .dark-panel *,
.cdk-overlay-pane .dark-panel * {
  color: var(--app-fg) !important;
  background: transparent !important;
}

/* --- Fix: stronger overrides to ensure combobox triggers and timeframe fields have a dark background and light text --- */
/* This addresses comboboxes that appear transparent or show black text (e.g. timeframe combobox) */

/* High-specificity rules covering MDC + legacy, compact fields and overlay content */
body.dark-theme ::ng-deep .compact-field .mat-select-trigger,
body.dark-theme ::ng-deep .compact-field .mat-mdc-select-trigger,
body.dark-theme ::ng-deep .compact-field .mat-select-value,
body.dark-theme ::ng-deep .compact-field .mat-mdc-select-value,
body.dark-theme .compact-field.timeframe-field .mat-select-trigger,
body.dark-theme .compact-field.timeframe-field .mat-mdc-select-trigger,
body.dark-theme .compact-field.symbol-field .mat-select-trigger,
body.dark-theme .compact-field.symbol-field .mat-mdc-select-trigger,
body.dark-theme .mat-select-trigger,
body.dark-theme .mat-mdc-select-trigger,
body.dark-theme .mat-select-value,
body.dark-theme .mat-mdc-select-value,
.cdk-overlay-container .mat-select-panel,
.cdk-overlay-container .mat-mdc-select-panel {
  background: var(--card-bg) !important;
  color: var(--app-fg) !important;
}

/* Ensure any nested spans/icons inside triggers are also light */
body.dark-theme ::ng-deep .mat-select-trigger *,
body.dark-theme ::ng-deep .mat-mdc-select-trigger *,
body.dark-theme .mat-select-trigger *,
body.dark-theme .mat-mdc-select-trigger * {
  color: var(--app-fg) !important;
}

/* Specific fix for mat-select value text classes (legacy + mdc) */
body.dark-theme .mat-select-value-text,
body.dark-theme .mat-mdc-select-value-text,
body.dark-theme ::ng-deep .mat-select-value-text,
body.dark-theme ::ng-deep .mat-mdc-select-value-text {
  color: var(--app-fg) !important;
}

/* Ensure symbol/timeframe combobox items and custom option markup are readable in dark mode */
/* Targets panels using the .dark-panel class, overlay panes, and MDC/legacy option classes */
.cdk-overlay-pane .dark-panel .symbol-option,
.cdk-overlay-pane .mat-select-panel .symbol-option,
.cdk-overlay-pane .mat-mdc-select-panel .symbol-option,
.dark-panel .symbol-option,
.mat-select-panel .symbol-option,
.mat-mdc-select-panel .symbol-option {
  display: flex;
  align-items: center;
  gap: 8px;
  color: var(--app-fg) !important;
  background: transparent !important;
}

.cdk-overlay-pane .dark-panel .symbol-option-text,
.cdk-overlay-pane .mat-select-panel .symbol-option-text,
.cdk-overlay-pane .mat-mdc-select-panel .symbol-option-text,
.dark-panel .symbol-option-text,
.mat-select-panel .symbol-option-text,
.mat-mdc-select-panel .symbol-option-text {
  color: var(--app-fg) !important;
}

/* Ensure the fallback mat-icon inside options is light */
.cdk-overlay-pane .dark-panel .symbol-option-fallback,
.cdk-overlay-pane .mat-select-panel .symbol-option-fallback,
.cdk-overlay-pane .mat-mdc-select-panel .symbol-option-fallback,
.dark-panel .symbol-option-fallback,
.mat-select-panel .symbol-option-fallback,
.mat-mdc-select-panel .symbol-option-fallback {
  color: var(--app-fg) !important;
}

/* Ensure any images used in options don't apply unexpected backgrounds */
.cdk-overlay-pane .dark-panel .symbol-option-icon,
.cdk-overlay-pane .mat-select-panel .symbol-option-icon,
.cdk-overlay-pane .mat-mdc-select-panel .symbol-option-icon,
.dark-panel .symbol-option-icon,
.mat-select-panel .symbol-option-icon,
.mat-mdc-select-panel .symbol-option-icon {
  background: transparent !important;
}

/* Reinforce option text color inside all select panels in dark mode (MDC + legacy) */
.cdk-overlay-pane .mat-option,
.cdk-overlay-pane .mat-mdc-option,
.cdk-overlay-pane .mat-option span,
.cdk-overlay-pane .mat-mdc-option span,
.dark-panel .mat-option,
.dark-panel .mat-mdc-option {
  color: var(--app-fg) !important;
  background: transparent !important;
}

/* Ensure compact form-field triggers are dark with light text (extra specificity) */
body.dark-theme ::ng-deep .compact-field .mat-select-trigger,
body.dark-theme ::ng-deep .compact-field .mat-mdc-select-trigger,
body.dark-theme .compact-field.timeframe-field .mat-select-trigger,
body.dark-theme .compact-field.timeframe-field .mat-mdc-select-trigger,
body.dark-theme .compact-field.symbol-field .mat-select-trigger,
body.dark-theme .compact-field.symbol-field .mat-mdc-select-trigger {
  background: var(--card-bg) !important;
  color: var(--app-fg) !important;
}
