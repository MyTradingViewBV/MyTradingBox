<div class="chart-container" 
     (dblclick)="onChartDblClick()" 
     (touchstart)="onTouchStart($event)"
     (touchmove)="onTouchMove($event)"
     (touchend)="onTouchEnd($event)"
     (mousedown)="onMouseDown($event)"
     (mousemove)="onMouseMove($event)"
     (mouseup)="onMouseUp($event)"
     (mouseleave)="onMouseUp($event)"
     (wheel)="onWheel($event)"
     [class.interacting]="isInteracting"
     [attr.data-gesture]="gestureType">
    
    <canvas baseChart 
            [data]="chartData" 
            [options]="chartOptions" 
            [type]="'candlestick'"
            #chartCanvas>
    </canvas>
    
    <!-- Enhanced gesture feedback -->
    <div class="interaction-overlay" 
         *ngIf="isInteracting && gestureType"
         [attr.data-gesture]="gestureType">
        <div class="gesture-indicator">
            <ng-container [ngSwitch]="gestureType">
                <span *ngSwitchCase="'zoom-x'" class="zoom-hint">↔ Candle Width</span>
                <span *ngSwitchCase="'zoom-y'" class="zoom-hint">↕ Candle Height</span>
                <span *ngSwitchCase="'pinch'" class="zoom-hint">🔍 Zoom</span>
                <span *ngSwitchCase="'pan'" class="zoom-hint">✋ Pan</span>
            </ng-container>
        </div>
    </div>
    
    <!-- Control panel (mobile-friendly) -->
    <div class="chart-controls">
        <div class="zoom-group">
            <button class="control-btn zoom-in" 
                    (click)="zoomIn()" 
                    title="Zoom In (Narrower Candles)"
                    [disabled]="!chartData.datasets?.[0]?.data?.length">
                <span>+</span>
            </button>
            <button class="control-btn zoom-out" 
                    (click)="zoomOut()" 
                    title="Zoom Out (Wider Candles)"
                    [disabled]="!chartData.datasets?.[0]?.data?.length">
                <span>−</span>
            </button>
        </div>
        
        <div class="action-group">
            <button class="control-btn fit-data" 
                    (click)="fitToData()" 
                    title="Fit All Data"
                    [disabled]="!chartData.datasets?.[0]?.data?.length">
                <span>⤢</span>
            </button>
            <button class="control-btn reset-zoom" 
                    (click)="resetZoom()" 
                    title="Reset to Default View"
                    [disabled]="!chartData.datasets?.[0]?.data?.length">
                <span>⌂</span>
            </button>
        </div>
    </div>
    
    <!-- TradingView-style instructions -->
    <div class="instructions" 
         *ngIf="!isInteracting && chartData.datasets?.[0]?.data?.length">
        <div class="instruction-group mobile">
            <div class="instruction-item">
                <span class="icon">↔️</span>
                <span class="text">Swipe left/right: Candle width</span>
            </div>
            <div class="instruction-item">
                <span class="icon">↕️</span>
                <span class="text">Swipe up/down: Candle height</span>
            </div>
            <div class="instruction-item">
                <span class="icon">🤏</span>
                <span class="text">Pinch: Zoom both</span>
            </div>
        </div>
        
        <div class="instruction-group desktop">
            <div class="instruction-item">
                <span class="icon">🖱️</span>
                <span class="text">Drag: Pan chart</span>
            </div>
            <div class="instruction-item">
                <span class="icon">🔄</span>
                <span class="text">Scroll: Zoom width</span>
            </div>
            <div class="instruction-item">
                <span class="icon">⇧</span>
                <span class="text">Shift+drag: Zoom width</span>
            </div>
            <div class="instruction-item">
                <span class="icon">⌃</span>
                <span class="text">Ctrl+drag: Zoom height</span>
            </div>
        </div>
    </div>
</div>
